<!--
     ~ Copyright 2018 BSC Msc, LLC
     ~
     ~ This file is part of the AuTe Framework project
     ~
     ~ Licensed under the Apache License, Version 2.0 (the "License");
     ~ you may not use this file except in compliance with the License.
     ~ You may obtain a copy of the License at
     ~
     ~ http://www.apache.org/licenses/LICENSE-2.0
     ~
     ~ Unless required by applicable law or agreed to in writing, software
     ~ distributed under the License is distributed on an "AS IS" BASIS,
     ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     ~ See the License for the specific language governing permissions and
     ~ limitations under the License.
-->

<div style="padding-top: 50px; padding-bottom: 10px;">

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-11">
        <div class="row">
          <div class="col-sm-12">
            <textarea  rows="1" style="resize: vertical; font-weight: bold; box-shadow: none;" placeholder="{{'Step description' | translate}}" class="form-control" [(ngModel)]="step.stepComment" ></textarea>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12">
            <div class="col-sm-12">
              <label for="timeoutValue">{{'Timeout' | translate}}:</label>
              <input id="timeoutValue" placeholder="{{'Timeout (ms)' | translate}}" [(ngModel)]="step.timeoutMs"/>
              <label>
                <input title="" type="checkbox" [(ngModel)]="step.timeoutEachRepetition">
                <b>{{'Repeat before each request' | translate}}</b>
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-1" *ngIf="showUpDownDeleteCloneButtons">
        <button style="white-space: normal;" class="btn btn-xs btn-block btn-default" (click)="addStepBefore()"><span class="glyphicon glyphicon-hand-left"></span> {{'Insert step' | translate}}</button>
        <button class="btn btn-xs btn-block btn-default" (click)="upStep()"><span class="glyphicon glyphicon-hand-up"></span> {{'Up' | translate}}</button>
        <button class="btn btn-xs btn-block btn-default" (click)="downStep()"><span class="glyphicon glyphicon-hand-down"></span> {{'Down' | translate}}</button>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <div class="input-group">
          <div class="input-group-btn">
            <select class="form-control" title="{{'Request type' | translate}}" [(ngModel)]="step.stepMode">
              <option [ngValue]="null" hidden>REST</option>
              <option [ngValue]="'REST'">REST</option>
              <option [ngValue]="'REST_ASYNC'">REST ASYNC</option>
              <option [ngValue]="'JMS'">JMS</option>
            </select>
          </div>
          <div class="input-group-btn" *ngIf="calculateStepMode() == 'REST'">
            <select class="form-control" title="{{'Request method' | translate}}" [(ngModel)]="step.requestMethod">
              <option [ngValue]="'POST'">POST</option>
              <option [ngValue]="'GET'">GET</option>
              <option [ngValue]="'PUT'">PUT</option>
              <option [ngValue]="'DELETE'">DELETE</option>
              <option [ngValue]="'PATCH'">PATCH</option>
            </select>
          </div>
          <input
            placeholder="{{'Step URL. Example' | translate}}: /relative/url?parameter=value"
            class="form-control"
            title=""
            [(ngModel)]="step.relativeUrl"
            *ngIf="calculateStepMode() == 'REST'" />
          <input
            placeholder="{{'Output queue name' | translate}}"
            class="form-control"
            style="width: 50%;"
            title=""
            [(ngModel)]="step.mqOutputQueueName"
            *ngIf="calculateStepMode() == 'JMS'" />
          <input
            placeholder="{{'Input queue name' | translate}}"
            class="form-control"
            style="width: 50%;"
            title=""
            [(ngModel)]="step.mqInputQueueName"
            *ngIf="calculateStepMode() == 'JMS'" />
          <div class="input-group-btn">
            <button class="btn btn-default" title="{{'Delete' | translate}}" *ngIf="showUpDownDeleteCloneButtons" (click)="deleteStep()"><span class="glyphicon glyphicon-minus"></span> {{'Delete' | translate}}</button>
            <button class="btn btn-default" title="{{'Disabled toggle' | translate}}" *ngIf="!step.disabled" (click)="disabledToggle()"><span class="glyphicon glyphicon-flag"></span> {{'Disable' | translate}}</button>
            <button class="btn btn-default" title="{{'Disabled toggle' | translate}}" style="color: red;" *ngIf="step.disabled" (click)="disabledToggle()"><span class="glyphicon glyphicon-flag"></span> {{'Disabled' | translate}}</button>
            <button class="btn btn-success" title="{{'Clone' | translate}}" *ngIf="showUpDownDeleteCloneButtons && step.code" (click)="cloneStep()"><span class="glyphicon glyphicon-paste"></span> {{'Clone' | translate}}</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="row">
      <div class="col-sm-12">
        <ul class="nav nav-tabs">
          <li [class.active]="tab == 'details'"><a href="#" (click)="selectTab('details')">{{'Details' | translate}}</a></li>
          <li [class.active]="tab == 'scenarioVariables'">
            <a href="#" (click)="selectTab('scenarioVariables')">{{'Scenario variables' | translate}} <span *ngIf="step.jsonXPath || (step.savedValuesCheck && Object.keys(step.savedValuesCheck).length)" class="glyphicon glyphicon-tag"></span></a>
          </li>
          <li [class.active]="tab == 'headers'">
            <a href="#" (click)="selectTab('headers')">{{'Headers' | translate}} <span *ngIf="step.requestHeaders" class="glyphicon glyphicon-tag"></span></a>
          </li>
          <li [class.active]="tab == 'sql'">
            <a href="#" (click)="selectTab('sql')">Sql <span *ngIf="step.sqlDataList?.length > 0" class="glyphicon glyphicon-tag"></span></a>
          </li>
          <li [class.active]="tab == 'mqResponses'">
            <a href="#" (click)="selectTab('mqResponses')">{{'Mock responses' | translate}} <span *ngIf="step.mockServiceResponseList?.length > 0 || step.mqMessages?.length > 0 || step.mqMockResponseList?.length > 0" class="glyphicon glyphicon-tag"></span></a>
          </li>
          <li [class.active]="tab == 'mqRequests'">
            <a href="#" (click)="selectTab('mqRequests')">{{'Mock requests' | translate}} <span *ngIf="step.expectedServiceRequestList?.length > 0 || (step.expectedMqRequestList?.length > 0 || step.scenarioVariableFromMqRequestList?.length > 0 || step.ignoreRequestsInvocations)" class="glyphicon glyphicon-tag"></span></a>
          </li>
          <li [class.active]="tab == 'polling'">
            <a href="#" (click)="selectTab('polling')">{{'Polling' | translate}} <span *ngIf="step.usePolling" class="glyphicon glyphicon-tag"></span></a>
          </li>
          <li [class.active]="tab == 'parameterSet'">
            <a href="#" (click)="selectTab('parameterSet')">{{'Test cases' | translate}} <span *ngIf="step.stepParameterSetList && step.stepParameterSetList.length != 0" class="glyphicon glyphicon-tag"></span></a>
          </li>
          <li [class.active]="tab == 'script'">
            <a href="#" (click)="selectTab('script')">{{'Script' | translate}} <span *ngIf="step.script" class="glyphicon glyphicon-tag"></span></a>
          </li>
          <li [class.active]="tab == 'json'"><a href="#" (click)="selectTab('json')">json</a></li>
        </ul>

        <div class="tab-content" style="padding: 10px; background-color: #ffffff">

          <!-- Details tab -->
          <div *ngIf="tab == 'details'" class="row">
            <div class="col-sm-6">
              <div class="row">
                <div class="col-sm-6" *ngIf="calculateStepMode() == 'REST'">
                  <label>{{'Request body type' | translate}}:</label>
                </div>
                <div class="col-sm-6" *ngIf="calculateStepMode() == 'JMS'">
                  <label>{{'Wait response timeout' | translate}}:</label>
                </div>
                <div class="col-sm-3">
                  <label>{{'Number of repetitions' | translate}}:</label>
                </div>
                <div class="col-sm-3">
                  <label>{{'Ignore response' | translate}}:</label>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6" *ngIf="calculateStepMode() == 'REST'">
                  <select class="form-control" title="{{'Request body type' | translate}}" [(ngModel)]="step.requestBodyType">
                    <option [ngValue]="'JSON'">{{'JSON request body (default)' | translate}}</option>
                    <option [ngValue]="'FORM'">{{'FORM-data request body' | translate}}</option>
                  </select>
                </div>
                <div class="col-sm-6" *ngIf="calculateStepMode() == 'JMS'">
                  <input title="" placeholder="N or variable (ms, 1000 default)" class="form-control" [(ngModel)]="step.mqTimeoutMs"/>
                </div>
                <div class="col-sm-3">
                  <input title="" placeholder="N or variable" class="form-control" [(ngModel)]="step.numberRepetitions"/>
                </div>
                <div class="col-sm-3" style="text-align: center; padding-top: 10px;">
                  <input title="" type="checkbox" [(ngModel)]="step.expectedResponseIgnore"><br/>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="row">
                <div class="col-sm-4" *ngIf="calculateStepMode() == 'REST'">
                  <label>{{'Expected status' | translate}}:</label>
                </div>
                <div class="col-sm-4">
                  <label>{{'Compare mode' | translate}}:</label>
                </div>
                <div class="col-sm-4" *ngIf="step.responseCompareMode == 'JSON'">
                  <label>{{'JSON compare mode' | translate}}:</label>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-4" *ngIf="calculateStepMode() == 'REST'">
                  <input title="" placeholder="Example: 200, 404, 500, [empty]" class="form-control" [(ngModel)]="step.expectedStatusCode"/>
                </div>
                <div class="col-sm-4">
                  <select class="form-control" title="{{'Compare mode' | translate}}" [(ngModel)]="step.responseCompareMode">
                    <option [ngValue]="'JSON'">JSON (default)</option>
                    <option [ngValue]="'FULL_MATCH'">Full match</option>
                    <option [ngValue]="'IGNORE_MASK'">Mask *ignore*</option>
                  </select>
                </div>
                <div class="col-sm-4" *ngIf="step.responseCompareMode == 'JSON'">
                  <select class="form-control" title="{{'JSON compare mode' | translate}}" [(ngModel)]="step.jsonCompareMode">
                    <option [ngValue]="'NON_EXTENSIBLE'">NON_EXTENSIBLE (Default. Not extensible, non-strict array ordering)</option>
                    <option [ngValue]="'STRICT'">STRICT (Not extensible, strict array ordering)</option>
                    <option [ngValue]="'LENIENT'">LENIENT (Extensible, non-strict array ordering)</option>
                    <option [ngValue]="'STRICT_ORDER'">STRICT_ORDER (Extensible, strict array ordering)</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
            <div class="col-sm-6" *ngIf="calculateStepMode() == 'REST'">
              <label>{{'Request body' | translate}}:</label>
              <div *ngIf="step.requestBodyType != 'FORM'">
                <textarea style="resize: vertical;" title="{{'Request body' | translate}}" class="form-control" rows="10" [(ngModel)]="step.request"></textarea>
              </div>
              <div *ngIf="step.requestBodyType == 'FORM'">
                <label>
                  <input title="" type="checkbox" [(ngModel)]="step.multipartFormData">
                  {{'multipart/form-data' | translate}}
                </label>
                <div class="clearfix"></div>
                <div *ngFor="let formData of step.formDataList" class="request-body-field">
                  <input class="form-control request-body-field__name" placeholder="{{'Field name' | translate}}" title="" [(ngModel)]="formData.fieldName"/>
                  <select class="form-control request-body-field__type" title="{{'Field type' | translate}}" [(ngModel)]="formData.fieldType">
                    <option [ngValue]="'TEXT'">{{'Text (default)' | translate}}</option>
                    <option [ngValue]="'FILE'">{{'File' | translate}}</option>
                  </select>
                  <ng-container *ngIf="formData.fieldType == 'FILE'">
                    <input class="form-control" placeholder="{{'File path' | translate}}" title="" [(ngModel)]="formData.filePath"/>
                    <input class="form-control" placeholder="{{'MIME type' | translate}}" title="" [(ngModel)]="formData.mimeType"/>
                  </ng-container>
                  <input class="form-control" *ngIf="formData.fieldType != 'FILE'" placeholder="{{'Field value' | translate}}" title="" [(ngModel)]="formData.value"/>
                  <button class="btn btn-default request-body-field__remove" (click)="removeFormData(formData)">-</button>
                </div>
                <button class="btn" style="margin-top: 7px; margin-left: 7px;" (click)="addFormData()">{{'Add field' | translate}}</button>
              </div>
            </div>
            <div class="col-sm-6" *ngIf="calculateStepMode() == 'REST'">
              <label>{{'Expected response' | translate}}:</label>
              <textarea style="resize: vertical;" title="{{'Expected response' | translate}}" class="form-control" rows="10" [(ngModel)]="step.expectedResponse"></textarea>
            </div>
            <div class="col-sm-6" *ngIf="calculateStepMode() == 'JMS'">
              <label>{{'Request JMS body' | translate}}:</label>
              <textarea style="resize: vertical;" title="{{'Request body' | translate}}" class="form-control" rows="10" [(ngModel)]="step.request"></textarea>
            </div>
            <div class="col-sm-6" *ngIf="calculateStepMode() == 'JMS'">
              <label>{{'Expected JMS response' | translate}}:</label>
              <textarea style="resize: vertical;" title="{{'Expected response' | translate}}" class="form-control" rows="10" [(ngModel)]="step.expectedResponse"></textarea>
            </div>
          </div>

          <!-- Scenario variables tab -->
          <div *ngIf="tab == 'scenarioVariables'">
            <div class="row">
              <div class="col-sm-6">
                <label>{{'Expected response' | translate}}</label>
                <textarea title="{{'Expected response' | translate}}" class="form-control" rows="13" [(ngModel)]="step.expectedResponse"></textarea>
              </div>
              <div class="col-sm-6">
                <label>{{'Scenario variables' | translate}} (JSON XPath):</label>
                <textarea placeholder="parameterName = $.element.items[2].title" rows="13" title="{{'Request headers' | translate}}" class="form-control" [(ngModel)]="step.jsonXPath"></textarea>
              </div>
            </div>
          </div>
          <div *ngIf="tab == 'sql'">
            <div *ngFor="let sqlData of step.sqlDataList">
              <div class="row">
                <div class="col-sm-12">
                  <label>{{'Sql parameters' | translate}}</label>
                  <input placeholder="paramNameFirst, paramNameSecond" class="form-control" title="" [(ngModel)]="sqlData.sqlSavedParameter"/>
                  <label>{{'Sql query' | translate}}</label>
                  <input placeholder="select fieldFirst, fieldSecond from myTable" class="form-control" title="" [(ngModel)]="sqlData.sql"/>
                  <label>{{'Sql return type' | translate}}</label>
                  <select class="form-control" title="{{'Sql return type' | translate}}" [(ngModel)]="sqlData.sqlReturnType" style="width: auto">
                    <option [ngValue]="'MAP'">{{'Map (default)' | translate}}</option>
                    <option [ngValue]="'OBJECT'">{{'Object' | translate}}</option>
                    <option [ngValue]="'LIST'">{{'List' | translate}}</option>
                    <option [ngValue]="'ROW'">{{'Row' | translate}}</option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-12">
                  <button class="btn btn-default" (click)="removeSqlData(sqlData)">
                    <span class="glyphicon glyphicon-minus"></span> {{'Remove' | translate}}
                  </button>
                </div>
              </div>
              <hr/>
            </div>
            <button class="btn btn-default" (click)="addSqlData()">
              <span class="glyphicon glyphicon-plus"></span> {{'Add' | translate}}
            </button>
          </div>
          <div *ngIf="tab == 'scenarioVariables' || tab == 'sql'">
            <div class="row">
              <div class="col-sm-12">
                <hr/>
                <label>{{'Check scenario variables' | translate}}</label>
              </div>
            </div>
            <div class="row" *ngFor="let checkedValueName of (step.savedValuesCheck ? Object.keys(step.savedValuesCheck) : [])">
              <div class="col-sm-4" style="text-align: right;">
                <label>
                  <a href="#" (click)="updateCheckedValueName(checkedValueName)">{{checkedValueName}} <small><span class="glyphicon glyphicon-edit"></span></small></a>
                </label>
              </div>
              <div class="col-sm-8">
                <div class="input-group">
                  <input placeholder="{{'Checked value' | translate}}" title="" class="form-control" [(ngModel)]="step.savedValuesCheck[checkedValueName]"/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" (click)="removeCheckedValue(checkedValueName)"><span class="glyphicon glyphicon-minus"></span> {{'Remove' | translate}}</button>
                  </span>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <button class="btn btn-default" (click)="addCheckedValue()"><span class="glyphicon glyphicon-plus"></span> {{'Add' | translate}}</button>
              </div>
            </div>
          </div>
          <div *ngIf="tab == 'headers'">
            <label>{{'Request headers' | translate}}:</label>
            <textarea placeholder="HeaderName: headerValue" rows="5" title="{{'Request headers' | translate}}" class="form-control" [(ngModel)]="step.requestHeaders"></textarea>
          </div>

          <!-- MQ responses tab -->
          <div *ngIf="tab == 'mqResponses'">
            <h4>{{'REST mock responses' | translate}}</h4>
            <div class="row" *ngIf="step.stepMode === 'REST_ASYNC'">
              <div class="col-sm-12">
                <label for="mock-polling-timeout">{{'Mock polling timeout' | translate}}</label>
                <input id="mock-polling-timeout" class="form-control" style="width: auto; display: inline; margin-right: 15px" [(ngModel)]="step.mockPollingTimeout">
                <label for="mock-retry-delay">{{'Mock retry delay' | translate}}</label>
                <input id="mock-retry-delay" class="form-control" style="width: auto; display: inline" [(ngModel)]="step.mockRetryDelay">
              </div>
            </div>

            <div class="row" *ngFor="let mockServiceResponse of step.mockServiceResponseList">
              <div class="col-sm-12">
                <app-mock-service-response [mockServiceResponse]="mockServiceResponse" (onDelete)="removeMockServiceResponse(mockServiceResponse)"></app-mock-service-response>
              </div>
            </div>
            <button class="btn btn-sm btn-default" (click)="addMockServiceResponse()"><span class="glyphicon glyphicon-plus"></span> {{'Add REST-mock' | translate}}</button>

            <hr class="item-solid-separator"/>

            <h4>{{'Messages Queue' | translate}}</h4>
            <div class="row" *ngFor="let mqMessage of step.mqMessages">
              <div class="col-sm-12">
                <label>{{'Queue name' | translate}}</label>
                <div class="input-group" style="margin-bottom: 5px;">
                  <input title="{{'Queue name' | translate}}" class="form-control" [(ngModel)]="mqMessage.queueName"/>
                  <span class="input-group-btn">
                    <button class="btn btn-sm btn-default" style="line-height: 1.9;" (click)="removeMqMessage(mqMessage)"><span class="glyphicon glyphicon-minus"></span>{{'Remove' | translate}}</button>
                  </span>
                </div>
              </div>
              <div class="col-sm-12">
                <label>{{'Queue message' | translate}}</label>
                <textarea class="form-control" placeholder="{{'Queue message' | translate}}" title="" rows="7" [(ngModel)]="mqMessage.message"></textarea>
              </div>
              <ng-container *ngIf="mqMessage.properties?.length > 0">
                <div class="col-sm-12">
                  <label>{{'Mq properties' | translate}}</label>
                </div>
                <div class="col-sm-5">
                  <label>{{'Name' | translate}}</label>
                </div>
                <div class="col-sm-5">
                  <label>{{'Value' | translate}}</label>
                </div>
              </ng-container>
              <ng-container *ngFor="let property of mqMessage.properties">
                <div class="col-sm-5" >
                  <input title="{{'Name' | translate}}" placeholder="messageId, correlationId, replyTo, timestamp, contentType, contentEncoding, ..." class="form-control" [(ngModel)]="property.name"/>
                </div>
                <div class="col-sm-6">
                  <input title="{{'Value' | translate}}" [placeholder]="property.name == 'timestamp' ? 'dd-MM-yyyy,HH:mm:ss aaa' : ''" class="form-control" [(ngModel)]="property.value"/>
                </div>
                <div class="col-sm-1">
                  <button class="btn btn-sm btn-default" (click)="removeMqProperty(mqMessage, property)"><span class="glyphicon glyphicon-minus"></span></button>
                </div>
              </ng-container>
              <div class="col-sm-12" style="margin-top: 7px">
                <button class="btn btn-sm btn-default" (click)="addMqProperty(mqMessage)"><span class="glyphicon glyphicon-plus"></span> {{'Add property' | translate}}</button>
              </div>
            </div>
            <hr class="item-small-separator">
            <button class="btn btn-sm btn-default" (click)="addMqMessage()"><span class="glyphicon glyphicon-plus"></span> {{'Add message' | translate}}</button>

            <hr class="item-solid-separator"/>

            <h4>{{'MQ mock responses' | translate}}</h4>
            <div class="row" *ngFor="let mqMockResponse of step.mqMockResponseList">
              <div class="col-sm-12">
                <app-mq-mock-response [mqMockResponse]="mqMockResponse" (onDelete)="removeMqMockResponse(mqMockResponse)"></app-mq-mock-response>
              </div>
            </div>
            <button class="btn btn-sm btn-default" (click)="addMqMockResponse()"><span class="glyphicon glyphicon-plus"></span> {{'Add MQ mock' | translate}}</button>
          </div>

          <!-- Mock services requests tab -->
          <div *ngIf="tab == 'mqRequests'">
            <h4>{{'Expected REST requests' | translate}}</h4>
            <div class="checkbox">
              <label>
                <input type="checkbox" [(ngModel)]="step.checkRequestsOrder"><b>{{'Check Request Order' | translate}}</b>
              </label>
              <label>
                <input type="checkbox" [(ngModel)]="step.ignoreRequestsInvocations"><b>{{'Ignore Expected Request Invocation' | translate}}</b>
              </label>
            </div>
            <div class="row" style="margin-bottom: 40px;" *ngFor="let expectedServiceRequest of step.expectedServiceRequestList; let i = index">
              <div class="col-sm-10">

                <div class="form-horizontal">

                  <!-- Pattern checkbox -->
                  <div class="col-sm-10 col-sm-offset-2">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" [(ngModel)]="expectedServiceRequest.urlPattern">
                        {{'URL pattern' | translate}}
                      </label>
                    </div>
                  </div>

                  <!-- Path input -->
                  <div class="form-group">
                    <label for="mockRequestPathInput {{ i }}" class="col-sm-2 control-label">
                      {{'Service name' | translate}} *:
                    </label>
                    <div class="col-sm-10">
                      <input
                        placeholder="{{'Service name' | translate}} *"
                        class="form-control"
                        [style.border-color]="expectedServiceRequest.serviceName ? '' : 'red'"
                        [(ngModel)]="expectedServiceRequest.serviceName"
                        id="mockRequestPathInput {{ i }}"
                      />
                    </div>
                  </div>

                  <!-- Ignored tags input -->
                  <div class="form-group">
                    <label for="mockRequestIgnoredTagsInput {{ i }}" class="col-sm-2 control-label">
                      {{'Ignored tags' | translate}}:
                    </label>
                    <div class="col-sm-10">
                      <input
                        class="form-control"
                        placeholder="{{'Ignored tags' | translate}}"
                        [(ngModel)]="expectedServiceRequest.ignoredTags"
                        id="mockRequestIgnoredTagsInput {{ i }}"
                      />
                    </div>
                  </div>

                  <!-- Repeat counter input -->
                  <div class="form-group">
                    <label for="mockRequestRepeatCountInput {{ i }}" class="col-sm-2 control-label">
                      {{'Repeat count' | translate}}:
                    </label>
                    <div class="col-sm-10">
                      <input
                        class="form-control"
                        placeholder="{{'Repeat count' | translate}}"
                        [(ngModel)]="expectedServiceRequest.count"
                        id="mockRequestRepeatCountInput {{ i }}"
                      />
                    </div>
                  </div>

                  <!-- Type matching select -->
                  <div class="form-group">
                    <label for="mockRequestTypeMatchingInput {{ i }}" class="col-sm-2 control-label">
                      {{'Type Matching' | translate}}:
                    </label>
                    <div class="col-sm-3">
                      <select
                        class="form-control"
                        title="{{'Type Matching' | translate}}"
                        [(ngModel)]="expectedServiceRequest.typeMatching"
                        id="mockRequestTypeMatchingInput {{ i }}"
                      >
                        <option [ngValue]="'empty'"></option>
                        <option [ngValue]="'equalToJson'">equalToJson</option>
                        <option [ngValue]="'equalToXml'">equalToXml</option>
                        <option [ngValue]="'XPath'">XPath</option>
                        <option [ngValue]="'contains'">contains</option>
                        <option [ngValue]="'matches'">matches</option>
                      </select>
                    </div>

                    <!-- Type matching expression input -->
                    <div class="col-sm-4">
                      <input
                        class="form-control"
                        placeholder="{{'Matching' | translate}}"
                        title=""
                        [(ngModel)]="expectedServiceRequest.pathFilter"
                      />
                    </div>

                    <!-- Compare mode -->
                    <div class="col-sm-3">
                      <select
                        class="form-control"
                        title="{{'Compare mode' | translate}}"
                        [(ngModel)]="expectedServiceRequest.jsonCompareMode"
                      >
                        <option [ngValue]="'NON_EXTENSIBLE'">NON_EXTENSIBLE (Default. Not extensible, non-strict array ordering)</option>
                        <option [ngValue]="'STRICT'">STRICT (Not extensible, strict array ordering)</option>
                        <option [ngValue]="'LENIENT'">LENIENT (Extensible, non-strict array ordering)</option>
                        <option [ngValue]="'STRICT_ORDER'">STRICT_ORDER (Extensible, strict array ordering)</option>
                      </select>
                    </div>
                    <div class="col-sm-3">
                      <label>
                        <input type="checkbox" [(ngModel)]="expectedServiceRequest.notEvalExprInBody"> {{'Do not evaluate expressions in body' | translate}}
                      </label>
                    </div>
                  </div>

                  <!-- Expected request -->
                  <div class="form-group">
                    <label for="mockRequestExpectedRequestTextarea {{ i }}" class="col-sm-2 control-label">
                      {{'Expected request' | translate}}:
                    </label>
                    <div class="col-sm-10">
                      <textarea
                        class="form-control"
                        placeholder="{{'Expected request' | translate}}"
                        style="resize: vertical;"
                        rows="7"
                        [(ngModel)]="expectedServiceRequest.expectedServiceRequest"
                        id="mockRequestExpectedRequestTextarea {{ i }}"
                      ></textarea>
                    </div>
                  </div>
                </div>

                <!-- Saved variables forms -->
                <div class="form-horizontal" *ngFor="let variable of expectedServiceRequest.scenarioVariablesFromServiceRequest; let j = index">

                  <hr class="item-solid-separator"/>

                  <!-- Delete saved variable button -->
                  <div class="col-sm-2 col-sm-offset-1" style="margin-bottom: 15px">
                    <button
                      style="white-space: normal;"
                      class="btn btn-xs btn-danger btn-block"
                      (click)="removeSavedVariableFromMockRequest(expectedServiceRequest, variable)"
                    >
                      <span class="glyphicon glyphicon-minus"></span>
                      {{'Mock request var delete' | translate}}
                    </button>
                  </div>
                  <div class="clearfix"></div>

                  <!-- Variable name input -->
                  <div class="form-group">
                    <label for="mockRequestVarNameInput {{ j }}" class="col-sm-2 control-label">
                      {{'Mock request var name' | translate}}:
                    </label>
                    <div class="col-sm-10">
                      <input
                        class="form-control"
                        placeholder="{{'Mock request var name' | translate}}"
                        [(ngModel)]="variable.scenarioVariableName"
                        id="mockRequestVarNameInput {{ j }}"
                      />
                    </div>
                  </div>

                  <!-- Matching type -->
                  <div class="form-group">
                    <label for="mockRequestVarMatchingTypeSelect {{ j }}" class="col-sm-2 control-label">
                      {{'Mock request var matching type' | translate}}:
                    </label>
                    <div class="col-sm-4">
                      <select
                        class="form-control"
                        title="{{'Mock request var matching type' | translate}}"
                        [(ngModel)]="variable.matchingType"
                        id="mockRequestVarMatchingTypeSelect {{ j }}"
                      >
                        <option [ngValue]="'REGEXP'">REGEXP</option>
                        <option [ngValue]="'XPATH'">XPATH</option>
                        <option [ngValue]="'JSONPATH'">JSONPATH</option>
                      </select>
                    </div>

                    <!-- Type matching expression input -->
                    <div class="col-sm-6">
                      <input
                        class="form-control"
                        placeholder="{{'Mock request var expression' | translate}}"
                        title=""
                        [(ngModel)]="variable.expression"
                      />
                    </div>
                  </div>
                </div>

                <!-- Add save variables button -->
                <div class="col-sm-2 col-sm-offset-1">
                  <button
                    style="white-space: normal;"
                    class="btn btn-xs btn-success btn-block"
                    (click)="addSavedVariableFromMockRequest(expectedServiceRequest)"
                  >
                    <span class="glyphicon glyphicon-plus"></span>
                    {{'Add saved variable from mock request' | translate}}
                  </button>
                </div>
              </div>

              <!-- Delete expected mock request button -->
              <div class="col-sm-2">
                <button class="btn btn-danger btn-sm" (click)="removeExpectedServiceRequest(expectedServiceRequest)">
                  <span class="glyphicon glyphicon-minus"></span>
                  {{'Remove' | translate}}
                </button>
              </div>
            </div>

            <!-- Add expected service request button -->
            <button class="btn btn-sm  btn-default" (click)="addExpectedServiceRequest()">
              <span class="glyphicon glyphicon-plus"></span>
              {{'Add expected mock request' | translate}}
            </button>
            <hr class="item-solid-separator"/>
            <h4>{{'Save scenario variables from MQ request' | translate}}</h4>

            <div class="row" *ngFor="let variable of step.scenarioVariableFromMqRequestList; let i = index">
              <div class="col-sm-10">
                <div class="form-horizontal">
                  <!-- Source queue input -->
                  <div class="form-group">
                    <label for="sourceQueueInput {{ i }}" class="col-sm-2 control-label">
                      {{'Source queue name' | translate}} *:
                    </label>
                    <div class="col-sm-10">
                      <input
                        placeholder="{{'Source queue name' | translate}} *"
                        class="form-control"
                        [style.border-color]="variable.sourceQueue ? '' : 'red'"
                        [(ngModel)]="variable.sourceQueue"
                        id="sourceQueueInput {{ i }}"
                      />
                    </div>
                  </div>

                  <!-- XPath input -->
                  <div class="form-group">
                    <label for="xpathInput {{ i }}" class="col-sm-2 control-label">
                      {{'XPath' | translate}} *:
                    </label>
                    <div class="col-sm-10">
                      <input
                        placeholder="{{'XPath' | translate}} *"
                        class="form-control"
                        [style.border-color]="variable.xpath ? '' : 'red'"
                        [(ngModel)]="variable.xpath"
                        id="xpathInput {{ i }}"
                      />
                    </div>
                  </div>

                  <!-- Variable name input -->
                  <div class="form-group">
                    <label for="variableNameInput {{ i }}" class="col-sm-2 control-label">
                      {{'Variable name' | translate}} *:
                    </label>
                    <div class="col-sm-10">
                      <input
                        placeholder="{{'Variable name' | translate}} *"
                        class="form-control"
                        [style.border-color]="variable.variableName ? '' : 'red'"
                        [(ngModel)]="variable.variableName"
                        id="variableNameInput {{ i }}"
                      />
                    </div>
                  </div>
                </div>
                <hr/>
              </div>

              <!-- Delete variable from MQ button -->
              <div class="col-sm-2">
                <button class="btn btn-danger btn-sm" (click)="removeVariableFromMq(variable)">
                  <span class="glyphicon glyphicon-minus"></span>
                  {{'Remove' | translate}}
                </button>
              </div>

            </div>

            <button class="btn btn-sm btn-default" (click)="addVariableFromMq()">
              <span class="glyphicon glyphicon-plus"></span>
              {{'Add scenario variable' | translate}}
            </button>
            <hr class="item-solid-separator"/>

            <h4>{{'Expected MQ requests' | translate}}</h4>

            <!-- Ignore undeclared requests checkbox -->
            <div class="col-sm-12">
              <div class="checkbox">
                <label>
                  <input type="checkbox" [(ngModel)]="step.ignoreUndeclaredMqRequests">
                  <b>{{'Ignore undeclared requests' | translate}}</b>
                </label>
              </div>
            </div>

            <div class="row" *ngFor="let expectedMqRequest of step.expectedMqRequestList; let i = index">
              <div class="col-sm-10">
                <div class="form-horizontal">

                  <!-- Source queue name -->
                  <div class="form-group">
                    <label for="sourceQueueNameInput {{ i }}" class="col-sm-2 control-label">
                      {{'Source queue name' | translate}} *:
                    </label>
                    <div class="col-sm-10">
                      <input
                        placeholder="{{'Source queue name' | translate}}"
                        class="form-control"
                        [style.border-color]="expectedMqRequest.sourceQueue ? '' : 'red'"
                        [(ngModel)]="expectedMqRequest.sourceQueue"
                        id="sourceQueueNameInput {{ i }}"
                      />
                    </div>
                  </div>

                  <!-- Ignored tags -->
                  <div class="form-group">
                    <label for="ignoredTagsInput {{ i }}" class="col-sm-2 control-label">
                      {{'Ignored tags' | translate}} *:
                    </label>
                    <div class="col-sm-10">
                      <input
                        placeholder="{{'Ignored tags' | translate}}"
                        class="form-control"
                        [style.border-color]="expectedMqRequest.ignoredTags ? '' : 'red'"
                        [(ngModel)]="expectedMqRequest.ignoredTags"
                        id="ignoredTagsInput {{ i }}"
                      />
                    </div>
                  </div>

                  <!-- Repeat count -->
                  <div class="form-group">
                    <label for="repeatCountInput {{ i }}" class="col-sm-2 control-label">
                      {{'Repeat count' | translate}} *:
                    </label>
                    <div class="col-sm-10">
                      <input
                        placeholder="{{'Repeat count' | translate}}"
                        class="form-control"
                        [style.border-color]="expectedMqRequest.count ? '' : 'red'"
                        [(ngModel)]="expectedMqRequest.count"
                        id="repeatCountInput {{ i }}"
                      />
                    </div>
                  </div>

                  <!-- Expected MQ request -->
                  <div class="form-group">
                    <label for="mqExpectedRequestTextarea {{ i }}" class="col-sm-2 control-label">
                      {{'Expected MQ request' | translate}}:
                    </label>
                    <div class="col-sm-10">
                      <textarea
                        class="form-control"
                        placeholder="{{'Expected MQ request' | translate}}"
                        style="resize: vertical;"
                        rows="7"
                        [(ngModel)]="expectedMqRequest.requestBody"
                        id="mqExpectedRequestTextarea {{ i }}"
                      ></textarea>
                    </div>
                  </div>
                </div>
                <hr/>
              </div>

              <!-- Delete MQ request -->
              <div class="col-sm-2">
                <button class="btn btn-danger btn-sm" (click)="removeExpectedMqRequest(expectedMqRequest)">
                  <span class="glyphicon glyphicon-minus"></span>
                  {{'Remove' | translate}}
                </button>
              </div>
            </div>
            <button class="btn btn-sm btn-default" (click)="addExpectedMqRequest()">
              <span class="glyphicon glyphicon-plus"></span>
              {{'Add expected mock MQ request' | translate}}
            </button>
          </div>

          <!-- Polling tab -->
          <div *ngIf="tab == 'polling'">
            <div class="row">
              <div class="col-sm-2">
                <label>
                  <input type="checkbox" title="Use polling" [(ngModel)]="step.usePolling"/>
                  {{'Use polling' | translate}}
                </label>
              </div>
              <div class="col-sm-2">
                <label>{{'Polling retry count' | translate}}:</label>
                <input title="" placeholder="N or variable" class="form-control" [(ngModel)]="step.pollingRetryCount"/>
              </div>
              <div class="col-sm-8">
                <label>{{'Polling' | translate}} json xpath:</label>
                <input placeholder="$.body.items" class="form-control" title="{{'Polling' | translate}} json xpath" [(ngModel)]="step.pollingJsonXPath" />
                <div class="help-block">{{'Waiting for json element exists. Example' | translate}}: $.body.items</div>
              </div>
            </div>
          </div>

          <div *ngIf="tab == 'parameterSet'">
            <app-step-parameter-set [stepParameterSetList]="step.stepParameterSetList"></app-step-parameter-set>
          </div>

          <!-- Script tab -->
          <div *ngIf="tab == 'script'">
            <label>{{'Script' | translate}}:</label>
            <textarea placeholder="" rows="6" title="{{'Script' | translate}}" class="form-control" [(ngModel)]="step.script"></textarea>
            <div class="help-block">
              <pre>stepStatus.exception - String. Если поле заполнено, то возникнет ошибка с указанным в поле текстом.<br/>scenarioVariables - Map. Список всех переменных сценария, доступны чтение и запись.<br/>response.statusCode - int. Код ответа.<br/>response.content - String. Содержимое ответа.<br/>response.headers - Map. Заголовки ответа. Пример: response.headers['header-name'][0]<br/>Пример сохранения заголовка в переменную:<br/>scenarioVariables.MY_VARIABLE = response.headers.get('header-name')[0];</pre>
            </div>
          </div>

          <!-- JSON tab -->
          <div *ngIf="tab == 'json'"><pre>{{step | json}}</pre></div>
        </div>
      </div>
    </div>
  </div>
</div>
